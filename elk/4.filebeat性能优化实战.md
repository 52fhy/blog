#### 背景介绍

&emsp;线上业务经常会打印很多日志, 用来排查业务的问题, 业界最常用的方案是ELK, 我们这边开始的时候使用redis作为一个中间代理, 业务的日志都打印到redis集群中, 但是随着日质量的增加, redis会成为瓶颈, 经常会积压, 这时候我们会使用业务日志输出到文件, 然后运维通过filebeat去把日志发送到kafka中, 在这个过程中我们经常发现filebeat占用的CPU会占满一个CPU, 有时候比业务的程序占用的CPU还多, 这个确实有点多.后来不断地尝试发现了一个最最关键的优化点.

#### 关键优化参数

```yaml

# 一般默认的都会进行gzip压缩, 这个参数是关键, 变成none后filebeat的CPU占用大大降低, 10%左右.
# 不过网卡的出口流量会增加, 不过流量的增加远远没有达到瓶颈, 不值一提.
output.kafka:
  hosts: ["192.168.1.2:9092","192.168.1.1:9092"]
  topic: "my-service"
  required_acks: 1
  compression: none
  max_message_bytes: 1000000
```

