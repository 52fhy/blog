####主机列表(inventory)

&emsp;Ansible管理着大量的主机,这些主机记录在inventory文件中,默认位置为`/etc/ansible/hosts`.

&emsp;你不但可以配置inventory文件,同时你也可以自定义更多的inventory文件,而且可以动态地从其他资源来获取主机列表,比如CMDB,下面我们来看看`/etc/ansible/hosts`的格式:

```
google.com

[webserver]
web1.com ansible_ssh_user=hadoop
mmweb ansible_ssh_host=web2.com ansible_ssh_port=22
2.4.5.6 http_port=80 maxRequestsPerChild=808

[dbserver]
db1.com:2222
1.2.4.8

[dbserver:vars]
ntp_server=ntp.atlanta.example.com
proxy=proxy.atlanta.example.com

[dmz]
192.168.1.[1-10]
www[01-50].qfpay.com
db-[a-f].qq.com

[china:children]
southeast
northeast
southwest
northwest

[southeast:children]
fujian
zhejiang

[southeast:vars]
some_server=foo.southeast.example.com
halon_system_timeout=30
self_destruct_countdown=60
escape_pods=2

[fujian]
host1
host2

[zhejiang]
host3
host4
```
 * 中括号中的webserver,dbserver为组名,可以自定义,也可以把主机单独列出,不放在任何组内,同一个主机可以同时被放在多个主机组内.
 * 可以使用IP,也可以使用域名.
 * 默认使用22端口,如果使用其它的端口,则可以在冒号后加上.
 * 也可以使用上面的方式指定alias `mmweb`.
 * 可以使用各种正则匹配,真牛逼~
 * 可以使用指定的用户.
 * 可以定义各种主机参数,如定义web端口,或者批量定义整个主机组的参数,如上所述的代理配置.
 * 当然也可以主机组嵌套主机组,同时可以给主机组设定变量,这些变量只能够通过`ansible-playbook`命令使用,不能通过`ansible`命令使用.

&emsp;Ansible更好的实践中,一般不把变量跟主配置放在一起,通常会被放在单独的配置文件中,使用YAML格式.假如你的主配置文件是:

`/etc/ansible/hosts`

配置文件中有一个主机名为`mmdev`,并且同时属于`qfpay`组和`qmm`组,变量配置文件可以定义为如下,这样就可以对这个主机起作用了.

```
/etc/ansible/group_vars/qmm
/etc/ansible/group_vars/qfpay
/etc/ansible/host_vars/mmdev
```
 * 比如qmm组的变量配置文件为如下:
	```
	---
	ntp_server: acme.example.org
	database_server: storage.example.org
	```当然也可以为空,不定义.
 
&emsp;更高级一点的用法可以这样,把配置文件写在`qmm`或者`mmdev`目录下:

```
/etc/ansible/group_vars/qmm/db_settings
/etc/ansible/group_vars/qmm/cluster_settings

```

 * **使用git管理配置文件是很不错的想法!**

&emsp;常用的变量参数:

```
ansble_ssh_host

ansible_ssh_port

ansible_ssh_user

ansible_ssh_pass (这个极不安全,使用--ask-pass或者SSH keys)

ansible_sudo 布尔值,是否使用sudo,默认为false.

ansible_sudo_pass 使用sudo密码,不安全,建议使用--ask-sudo-pass

ansible_sudo_exe  sudo命令路径

ansible_connection 连接类型，可以是local、ssh或paramiko，ansible1.2之前默认为paramiko,后来改成了智能识别,先判断看看ssh是否可用.

ansible_ssh_private_key_file ssh使用的私钥文件,当你有很多很多keys而又不想使用ssh agent的时候很管用.

ansible_shell_type 默认为`sh`,也可以从这里设置为`zsh`,`bash`等.

ansible_python_interpreter 当目标主机python环境很多的时候使用.

ansible\_\*\_interpreter 让Ruby,Perl等像ansible_python_interpreter一样工作.这个代替了远程主机中的`#!`.
```

&emsp;一些例子:

```
some_host         ansible_ssh_port=2222     ansible_ssh_user=manager
aws_host          ansible_ssh_private_key_file=/home/example/.ssh/aws.pem
freebsd_host      ansible_python_interpreter=/usr/local/bin/python
ruby_module_host  ansible_ruby_interpreter=/usr/bin/ruby.1.9.3
```
