### <p align=center>现实场景下的Docker在Yelp</p>


每天有成千上万的企业正在使用Yelp的SeatMe系统去管理它们的就座和预定。鉴于这些系统对于很多企业的关键性，拥有一个稳定的系统对我们来说是非常地重要的。这篇博客将要深入地讲解我们是怎样使用Docker可靠地开发跟部署Yelp SeatMe系统的。Docker是一个非常强大的生产环境助推器，已经大大简化了我们的部署方式。希望通过这篇博客让你们了解怎样在你们的团队中使用Docker。首先，我要简单介绍一下Yelp SeatMe系统的背景，和它的开发部署方式。

#### `Yelp SeatMe`是什么？

餐厅通过我们原生的iPad应用或网站接受和管理客户的预定。我们保持客户所有的终端的信息实时同步，同时我们也支持离线更改当客户在没有联网的情况下。

我们的技术栈：

 * 客户端的`Javascript`我们把[Backbone](http://backbonejs.org/)用在我们单页的应用程序上
 * `Python`是我们后端的语言，[Django](https://www.djangoproject.com/)作为我们的web框架
 * 我们使用[Celery](http://www.celeryproject.org/)和[RabbitMQ](http://www.rabbitmq.com/)来处理我们的异步任务
 * [Postgres](http://www.postgresql.org/)数据库，使用触发器的数据验证和更新通知，以支持我们的同步协议和长轮询引擎

我们把整个平台都放到了`AWS`上，我们使用[Chef](https://www.chef.io/chef/)作为我们的主要工具来配置服务器，管理部署和组织我们的测试/灰度/线上环境。

#### 在生产环境使用`Docker`

一年前，我们使用`Docker`容器开启了一种新的方式来让我们的（测试环境，灰度环境，生产环境）更加地一致和让我们的部署流程更加简化。

在我们使用容器之前，所有的部署一个web应用的逻辑被放在`Chef`的配置文件里。部署流程大概像这样：

 * 设置目录权限
 * 安装`python`的依赖组件和依赖包
 * 下载一个指定的`git`标签到本地的`git`分支
 * 保留最近的几个版本来确保我们可以快速回滚

这些`Chef`的配置文件对于新工程师来说不是那么容易被接受，因为它们使用一种不同的语言（Ruby）而且使用一个复杂的框架。这些设置使部署变得脆弱和不易改变。容器来拯救啦！

通过使用`Docker`，我们能够简化`Chef`管理的部署部分，改成简单的`Docker`容器的操作：

 * 拉取一个指定的`Docker`镜像到服务器
 * 通过健康检查来是服务器停止
 * 停止存在的容器
 * 给新的镜像打一个易读的名字的标签来区分出当前的版本（www:latest）
 * 启动这个镜像（以及所有它的文件系统的映射等等），并使用一个新的名字来命名这个容器（www）

使用`Docker`的好处：

 * 通过对`Dockerfile`的资源控制管理的编辑来增加开发者对环境的控制
 * 消除服务器环境的不统一，超出`Chef`已经提供的
 * 减少了`Chef`配置成百上千应用所需要的代码量
 * 集中了部署镜像库而且永远可以对应到某个具体的`git`提交
 * 我们持续集成了我们的`Docker`镜像，所以每一次`code review`通过后总会生成一个可部署的镜像
 * 现在开发者可以修改系统级别的包，而不需要运维团队来做这件事了

经过两个月的开发和测试，我们在2014年10月初期把`Docker`用到了生产环境而且没有遇到很大的困难。
