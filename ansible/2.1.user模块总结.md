####user模块

&emsp;系统管理中经常需要对账户的操作.下面是来看看ansible的user模块的处理.

1. 创建新用户.

```
---

- hosts: all
  remote_user: root
  vars:
    passwd: $6$rounds=100000$WtB9eG87.2KI1Zvh$FUpHYkGSal0iUF.XwdGnq1m/t.QMzizNb673p7fbT.9HerUjc7AfiL6.KHR308CmcDWzrKD6b7SIpzAWcwhKD0
  tasks:
   - name: create new users.
     user: name=rocky password={{passwd}} shell=/bin/bash home=/home/rocky
```
&emsp;简单解释:`vars`是定义变量,playbooks可以使用jinja2的模板来传参.默认的话,不指定组的话,会创建跟用户名一样的组并设置为主组.如果想指定其它的组为主组,可以使用`group`参数,这个参数的值必须是存在的组名.不存在会报错.关于密码,安全原因不使用明文,官方推荐一个方法:
 * 先安装`passlib`模块:`pip install passlib`

 * 然后执行 `python -c "from passlib.hash import sha512_crypt; import getpass; print sha512_crypt.encrypt(getpass.getpass())"` 会提示你输入密码并返回一个加密的字符串,即上述中passwd的value.

2. 删除指定用户,简单的playbooks如下:

```
---

- hosts: testpc
  remote_user: root
  tasks:
   - name: delete users.
     user: name=rocky state=absent remove=yes force=yes
```

