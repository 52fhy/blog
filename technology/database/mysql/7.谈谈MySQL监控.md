#### 背景介绍

&emsp;最近在开发运维平台MySQL监控这一块,花了一周的时间做了一个简版的MySQL可视化监控看版,大致思路是这样的:

* 在每一个待监控的数据库上创建一个统一的账号,不赋予任何权限
 `CREATE USER 'devops'@'172.100.102.101' IDENTIFIED BY '123456';`
* 写一个脚本定时(每分钟)去查询每个数据库的状态(比如`show global status`等)并存储到`InfluxDB`里面,如果是计数器的话,比如`Com_*`系列,就每隔5分钟执行一次并计算5分钟内的差值,最后一条存储在MySQL,没轮询一次就去对比MySQL中的那条记录,如果符合条件就把差值存放在`InfluxDB`
* 使用`echarts`做一些可视化的图表用来展示.

&emsp;这篇文章只是个人对MySQL监控的一个总结,公司使用的是`mysql5.5.18`,马上就会改成`mariadb`,道理都是类似的,说一说大概的思路,基础监控这里不再赘述.

#### 为什么要监控

* 实时查看MySQL当前的运行状态,保证数据库的正常运行
* 及时发现性能瓶颈,扩容
* 监控系统就是根据系统的各项状态析的，让我们能够尽可能多的提前预知系统可能会出现的异常状况, 也要在异常出现后的第一时间知道系统已经出现异常，否则之前的设计工作很可就能白费了。


#### 关键监控指标

*  复制状态

关键看`Slave_IO_Running`和`Slave_SQL_Running`的状态

```sql
mysql> show slave status\G;
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 192.20.20.7
                  Master_User: repl
                  Master_Port: 3305
                Connect_Retry: 100
              Master_Log_File: mysql-bin.000174
          Read_Master_Log_Pos: 156582667
               Relay_Log_File: mysql-relay-bin.001172
                Relay_Log_Pos: 7317481
        Relay_Master_Log_File: mysql-bin.000174
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB:
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table: mysql.%
                   Last_Errno: 0
                   Last_Error:
```












#### 参考文档

[DataDog](https://github.com/DataDog/the-monitor/tree/master/mysql)