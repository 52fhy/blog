#### 背景介绍

公司最近在不断地缩减成本, 释放服务器, 导致测试环境很多的服务都部署到了同一台服务器, 而且很多的服务都是Java写的, 非常地占用内存, 我负责的权限系统当然也不例外, 这就经常导致服务器的内存被占满了, 服务器内存用完了以后, 如果新的进程启动, Linux就会杀死已有的进程, 然后释放内存, 不幸的是我的权限系统经常性地被杀死, 虽然是测试环境, 业务方还是很敏感的, 经常群里反馈. 

#### 解决办法

新申请机器是不可能的, 寻找新的测试机器, 修改起来还是比较麻烦的, 最简单直接的办法就是理解Linux在内存满的时候优先杀死哪个进程的逻辑, 让自己的权限系统避免被杀死即可.

经过网上搜索学习, Linux会给每一个进程计算一个分数`oom_score`, 通过如下方式查看:

```
cat /proc/{PID}/oom_score
```

这个分数越高, 在内存不足的时候就越优先杀死该进程, 通常有如下的几个因素影响分数:

```
1. 内存越大, 分数越高
2. root用户启动的进程会低一些, 表示该进程更重要
3. 运行时间长的进程分数会低一些
```

我们关心的是另一个可以手工影响这个分数的参数: `oom_score_adj`, 这个分数的范围是`[-1000:1000]`,

我们可以把权限系统进程的该值设置为-1000, 这样就不会因为系统OOM而杀死了.霸气侧漏!

```
echo -1000 > /proc/{pid}/oom_score_adj
```