#### 背景介绍

&emsp;最近在开发运维平台,刚刚上线,同学们刚刚开始使用,有很多细节等待完善,遇到了这样一个场景,QA同学正在使用运维平台为一个服务添加一个部署,因为点击部署的时候后台需要操作很多动作(使用fabric),因为那个按钮点击完以后没有显示动画效果,导致QA同学以为没有点击,于是乎又点击了一次,结果出现了两个部署,除了部署ID不同以外,其他的参数完全一样,这其实是不应该出现的,于是我跟同事做了两个方面的改动,一是在前端加上了动画效果,点击完以后出现动画效果,完成以后,动画效果消失,同时也加上了禁止重复点击的事件,就是当用户触发点击事件后就把那个按钮置灰(disabled),禁止重复提交,而是在数据库上加上一个联合唯一索引,下面说说这个东西吧.

#### 定义

&emsp;唯一索引是一种索引,作用是不允许出现相同索引的记录,系统在创建该索引时检查是否有重复的键值,并在`update`和`insert`的时候进行检查.

#### 使用场景

&emsp;一般在要求某一字段或几个字段具有唯一属性的时候使用,比如身份证号字段等,在本案例中使用场景为该部署的`deploy_name`,`dev_id`做一个联合唯一索引.

#### 操作索引

1. 在创建表的时候就创建唯一索引

  ```
  >create table Person(
    Id int(4) not null,
    UserName varchar(255),
    Identify_num int(4),
    unique (Identify_num)
    );

    ```

2. 当表已经存在的时候创建唯一索引

  `u2` 是索引的名字,下面的语句是为表`deploy`创建了一个联合为一索引
  ```
  >ALTER TABLE deploy add UNIQUE u2 (deploy_name,dev_id);
  ```

3. 查看索引

  ```
  >show index from deploy;
  +---------+--------------+------------+----------------+---------------+-------------+---------------+------------+----------+--------+------------
  | Table   |   Non_unique | Key_name   |   Seq_in_index | Column_name   | Collation   |   Cardinality |   Sub_part |   Packed | Null   | Index_type
  |---------+--------------+------------+----------------+---------------+-------------+---------------+------------+----------+--------+------------
  | deploy  |            0 | PRIMARY    |              1 | deploy_id     | A           |             2 |     <null> |   <null> |        | BTREE
  | deploy  |            0 | u2         |              1 | deploy_name   | A           |             2 |     <null> |   <null> |        | BTREE
  | deploy  |            0 | u2         |              2 | dev_id        | A           |             2 |     <null> |   <null> |        | BTREE
  | deploy  |            0 | uuu        |              1 | deploy_id     | A           |             2 |     <null> |   <null> |        | BTREE
  +---------+--------------+------------+----------------+---------------+-------------+---------------+------------+----------+--------+------------
  ```

4. 删除索引

刚才查看了索引,根据索引的名称来删除,注意当创建索引的时候如果制定了名称就会使用指定的名称,如果没有指定名称,它会自动创建名称,并且是唯一的.下面的deploy_id_6是索引名称.

```
>ALTER TABLE deploy drop index deploy_id_6;
```  
