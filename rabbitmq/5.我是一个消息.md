#### 背景介绍

&emsp;事物总是不断演进的, 技术也一样, 刚来公司的时候公司的所有的服务都耦合在一起, 乱如一团, 不好维护, 随着公司不断的发展, 服务被不断地拆分, 逐渐地拆解成一个一个的小团队, 然后每个小团队维护各自的服务, 各个团队之间的服务通过各种接口来交互, 当然很多场景也通过消息队列来交互, 这里就简单介绍一下`RabbitMQ`.

#### 为什么会选择RabbitMQ

消息队列组件有很多种, 为啥会选择`RabbitMQ`呢, 网上对比各个组件优劣的文章很多, 我们选择消息中间件优先考虑的因素有下面几个:

* 稳定可靠性

`RabbitMQ`支持`AMQP-0-9-1`协议, 有很多保证消息可靠的协议


* 扩展支持

公司当初都是`PHP`的项目, `RabbitMQ`是少数支持`PHP`的消息队列.(主因)

> 技术选型也是一门技术, 不能一味追求新鲜时髦, 要根据具体场景, 不同团队的特点做出选择.


#### 使用场景

公司的业务是做视频的, 所以每天会有很多的用户上传视频, 用户上传的视频是通过服务A上传到公司的服务器上, 然后还要经过服务B去做转码, 同时还要经过服务C去做视频审核, 这个场景使用消息队列最好不过了, 充分利用了消息队列的`解耦`功能.

![image](https://user-images.githubusercontent.com/7486508/42719951-396c7130-8751-11e8-9ca6-a64083437a17.png)

绝大多数场景中我们使用的是`fanout`类型的`exchange`, 这样发送方的每个消息都会传递给`绑定`到这个`exchange`的所有`queue`, 消息内容的取舍让业务方自己决定, 对业务方来说也是比较自由的.


#### RabbitMQ磁盘占用高的问题

有一次遇到这样一个情况, 一个消费方上线以后, `RabbitMQ`的磁盘IO迅速飙升, 这个新接入的消费端的服务是一个新来的同事使用`Spring Boot`写的, 开始一直以为是这个新同事的程序配置有问题, 于是我花费了一个周六的时间, 自己学习`Spring`写了一个简单的消费`RabbitMQ`的程序, 调整了一上午, 发现我的程序开始消费的时候IO也是很高的, 折腾了半天, 还是没找到导致磁盘IO升高的原因. 

#### 参考文章

* [消息中间件选型](http://www.infoq.com/cn/articles/kafka-vs-rabbitmq)