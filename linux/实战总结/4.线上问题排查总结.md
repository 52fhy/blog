#### 背景介绍

&emsp;作为一个运维开发工程师, 经常会有到线上排查服务器问题的时候, 经常遇到的场景和使用的命令也就那么几个, 这里总结一下常见的, 方便出问题以后快速调试!这是一篇值得收藏并经常查看的文章, 所以我会不断更新这篇文章, 力图成为一片经典文章!

#### 排查点以及相关命令

##### 日志查看

* 实时查看某一个日志文件

```bash
$tail -f access.log
$tailf access.log

实战中一般情况下, 这两个命令效果是一样的, 但是在一下科技的时候由于经常会有size很大的日志,
这种情况下使用tailf就会卡主不动, 这一点需要注意.
```

* 从日志中查看有用的信息

线上经常会去日志文件中查看某个时间点的有用的日志信息, 而且线上的日志文件都比较大, 如果使用vim的话很可能把内存吃满, 很危险, 这时候我们常常会使用`less`命令, 占用内存少, 并且可以上下翻页, 搜索关键字等.


```bash
$less -N access.log    # -N 显示行号

空格		向下翻N行
pageUP/pageDOWN		翻页
Ctrl-b / Ctrl-f		翻页, 类似于vim的用法
/字符串：搜索“字符串”的功能, 使用n/N向上/向下搜索
```

##### 整体系统实时状态查看

* `top`

一般线上负载高或者系统慢的时候, 登录到服务器上首先要对系统有一个整体上的了解, 一般使用top, 当然如果有htop就更好.通过top我们重点查看一下几点:

	1. 系统的负载情况
	2. 整体的进程状态, 总共多少个进程启动, 多少个在运行, 多少个在休眠,多少个僵尸进程
	3. 占用CPU/MEM最高的进程的状态


```bash
top常用的交互命令:

1		显示每个CPU的占用情况
M		按照内存使用排行
P		按照CPU的使用排行
H		显示线程信息, 比如想看某个进程中哪个线程占用的资源情况
c		显示进程的启动命令的全称
z		显示彩色, 虽然很难看
u		显示某个用户的进程, 输入u后会提示输入用户名

```

##### 网络连接查看

* 整体的各个状态的数量

```bash
$ netstat -antp|awk '{print $6}'|sort|uniq -c|sort -nr
     12 ESTABLISHED
      7 TIME_WAIT
      3 LISTEN
      1 Foreign
      1 established
```

* 显示所有在监听的端口

```
$ netstat -lntp

Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name
tcp        0      0 0.0.0.0:8000                0.0.0.0:*                   LISTEN      1846/python3.6
tcp        0      0 127.0.0.1:32000             0.0.0.0:*                   LISTEN      -
tcp        0      0 127.0.0.1:3306              0.0.0.0:*                   LISTEN      31630/mysqld
tcp        0      0 127.0.0.1:6379              0.0.0.0:*                   LISTEN      18741/redis-server
tcp        0      0 0.0.0.0:2222                0.0.0.0:*                   LISTEN      9086/python3
```

* 显示所有的tcp的连接, 包括各个状态的tcp连接

```bash
$ netstat -antp

tcp        0      0 192.168.11.54:2222          111.202.106.229:22661       ESTABLISHED 9086/python3
tcp        0      0 192.168.11.54:2222          111.202.106.229:46664       ESTABLISHED 9086/python3
tcp        0      0 192.168.11.54:2222          111.202.106.229:48404       ESTABLISHED 9086/python3
```

* 查看连接服务器指定端口的客户端数量的排行榜(根据IP统计)

```bash
$ netstat -antp|grep "192.168.11.54:2222"|awk '{print $5}'|awk -F: '{print $1}'|sort|uniq -c|sort -nr|head -20
     14 111.202.106.229
      4 172.16.200.1
比如查看连接服务器2222端口的客户端, 按照IP连接个数的排行榜, 可以初步确定是否为DDOS攻击
```

* 根据进程查看网速

有时候某一台机器的带宽占用很高,这个时候`nethogs`命令就会派上用场喽, 注意只能使用root执行, 有时候可能不太准, 但是至少能知道那个程序占用的带宽

```bash
# nethogs eth0
```

* 根据具体的端口连接信息查看网速

有时候知道了某个服务占用带宽大, 但是又想进一步知道哪一个客户端干的, 这时候`iftop`就派上用场了

```bash
# iftop 简洁明了, 不做过多介绍

```

* 快速查看网卡信息

```bash
$ ip a
```














