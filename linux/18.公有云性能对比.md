# 公有云对比


> 测试时间: 2017-12-06

#### 基础参数

对比的公有云有阿里云, 腾讯云, 华为云, 为了最大化接近真实生产环境, 我们选择了4核8G的型号, 普通型号, 不是CPU/内存增强版本! 使用的系统都是`CentOS7`, 注意这里对比的思路是购买相同配置相似价格的硬件然后执行相同的命令, 然后对比执行以后的结果, 部分结果并不是最高的性能, 比如测试网络的时候只是起了单个线程, 并没有使用多线程, 有机会补上.以下数据绝对真实!

| 厂商名称  | 服务器型号 | 服务器参数 | 价格(月)(未包含带宽) |
| -------- | -------- | --- | ---------- |
| 阿里云  | ecs.n1.large | 4核8G  | 340(打折以后, 不打折也400左右) |
| 华为云  | s2.xlarge.2 | 4核8G | 400(未打折) |
| 腾讯云  | S2.LARGE8 | 4和8G | 360(未打折) |

> 从价格上看, 腾讯是其中最便宜的, 因为阿里打折以后和腾讯不打折价格类似, 真正使用腾讯以后肯定会比上面显示的要低

#### 整体性能

UnixBench 是测试类 Unix 系统性能的老牌工具，也是常用的基准测试工具。它会执行 11 个单项测试，包括字符串处理、浮点运算效率、 文件数据传输、管道吞吐等，然后将结果与一个基准系统进行比较，得到一个指数值。指数值越高，性能越好。

> 对服务器性能有一个整体的认识

| 厂商名称  | 服务器型号 | 评测得分 | 
| -------- | -------- | --- |
| 阿里云  | ecs.n1.large | 3226 |
| 华为云  | s2.xlarge.2 | 4270 |
| 腾讯云 | S2.LARGE8 | 3871.1 |

> 整体性能来看, 华为最实在, 腾讯中规中矩, 阿里云最坑

#### CPU

可以使用cyclictest来测试CPU的延迟, 直接看结果, 数字越小延迟越低, 性能越高!

| 厂商名称  | 服务器型号 | 评测得分 | 
| -------- | -------- | --- |
| 阿里云  | ecs.n1.large | 16 |
| 华为云  | s2.xlarge.2 | 7 |
| 腾讯云 | S2.LARGE8 | 13 |

#### 内存

mbw 是一个 Linux 内存性能测试工具，可以测试内存数据拷贝操作的速度。速度越快，性能越高。在内存大小相同的情况下，该指标就显得比较重要，该指标越高越好。

| 厂商名称  | 服务器型号 | 评测速度 | 
| -------- | -------- | --- |
| 阿里云  | ecs.n1.large | 6483.680 MiB/s |
| 华为云  | s2.xlarge.2 | 7323.964 MiB/s |
| 腾讯云 | S2.LARGE8 | 8845.005 MiB/s |

#### 磁盘IO

使用`fio`测试随机读写


| 厂商名称  | 服务器型号 | 读取速度 | 写入速度 | IO延迟 |
| -------- | -------- | --- | --- | --- |
| 阿里云  | ecs.n1.large | bw=4964.8KB/s, iops=1241 | bw=4851.8KB/s, iops=1212 | 250 us|
| 华为云  | s2.xlarge.2 | bw=4046.9KB/s, iops=1011 | bw=2971.7KB/s, iops=742 | 650us |
| 腾讯云 | S2.LARGE8 | bw=8046.4KB/s, iops=2011 | bw=8032.2KB/s, iops=2008 | 1.1ms |


#### 网络性能

本次测试方法为开了两台相同配置并且在同一个内网的机器

TCP:

```
netperf -H 192.168.1.138 -p 11256 -t TCP_STREAM -l 300
```

UDP:

```
netperf -H 192.168.1.138 -p 11256 -t UDP_STREAM -l 300 -- -m 1400
```

然后从服务端执行:

```
sar -n DEV 2
```


| 厂商名称  | 服务器型号 | TCP | UDP |
| -------- | -------- | --- | --- |
| 阿里云  | ecs.n1.large | 100M/s | 100M/s |
| 华为云  | s2.xlarge.2 | 700M/s | 160M/s |
| 腾讯云 | S2.LARGE8 | 100M/s | 130M/s |





#### redis

对比redis的方法是这样的, 每一家都创建一个1G主从版的redis实例, 并且都是跟上面的服务器在同一个局域网中, 使用上面的服务器写一个python脚本, 同时插入和同时读相同的数量的key, 对比一下消耗的时间脚本如下:

```
import redis

client = redis.StrictRedis(host='192.168.1.16', port=6379, password='728')

for i in range(100000):
    client.set(str(i), "hi")
```

时间统计如下:

| 厂商名称  |  写入 | 读取 |
| -------- | --- | --- |
| 阿里云  |   31.4s | 31s |
| 华为云  |  32.8s | 30s|
| 腾讯云 | 37s | 40s |

相比较来说, 阿里云速度最快, 而且支持的类型和功能最全面, 腾讯和华为只是有这个服务, 跟阿里差的有点远. 比如阿里提供的是域名, 腾讯和华为提供的是一个内网的IP, 华为有一点比较坑, 说是买的1G, 其实是1G中包括持久化的存储, 严重不足.除了阿里以外都没有提供白名单机制.

#### 参考链接

* [CloudTesting](https://github.com/bingjin/CloudTesting/tree/master/test_vm)
* [netperf使用](http://blog.51cto.com/dingtongxue1990/1853714)
* [阿里云测试网络](https://www.alibabacloud.com/help/zh/faq-detail/55757.htm)
