#### 背景介绍

&emsp;因为之前翻译的一本谷歌出版的运维图书而被阿里云的同事内推了,第一次电话面试中问了很多关于进程间通讯的问题,当时回答的并不是很好,于是利用整个国庆期间学习了这一块的知识,这一章是关于socket的方法.

#### socket模块常见用法

* getaddrinfo

```
socket.getaddrinfo(host, port[, family[, socktype[, proto[, flags]]]])
获取给定地址的详细信息
>>>import socket
>>>s = socket.getaddrinfo('jp.rockywu.me', 80, 2, 1, 6)
>>>print s
[(2, 1, 6, '', ('118.193.81.214', 80))]

2 指的是AF_INET Ipv4协议
1 指的是SOCK_STREAM tcp协议
6 指的是ROTO_TCP 一般配合1,表示TCP协议

```

* gethostname

```
获取Linux服务器名称hostname
>>> socket.gethostname()
'mmdev01'
>>>
```

* gethostbyname

```
获取主机的IP地址
>>> socket.gethostbyname(socket.gethostname())
'118.193.81.214'
```

* inet_pton

```
将点分十进制格式的IP地址转换为更底层的数据格式,一般用于判断IP地址的格式

def validIpAddr(ip):
    try:
        socket.inet_pton(socket.AF_INET, ip)
        return True
    except socket.error:
        return False
```

* IP --> Int / Int --> Ip

```
import socket
import struct

def Ip2Int(ip):
    return struct.unpack("!L",socket.inet_aton(ip))[0]

def Int2Ip(i):
     return socket.inet_ntoa(struct.pack("!L",i))

```

#### 简单的TCP Server/Client

![TCP Server/Client](https://raw.githubusercontent.com/hellorocky/blog/master/picture/3.basic_socket.png)

```
TCP server(没有错误处理)

import socket

#socket.AF_INET表示Ipv4,SOCK_STREAM表示TCP协议
server      = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#设置地址复用,如果不设置的话,当调用socket.close()或者ctrl+c关闭服务器后还得经过TIME_WAIT的过程之后才能使用,马上启动的时候会提示端口被占用
server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
#定义服务端要绑定的地址(元组)
server_addr = ("0.0.0.0", 1234)
#绑定地址
server.bind(server_addr)
#监听地址,参数指定了客户端连接的最大的队列数量,大部分的操作系统为5,超过的会被拒绝
server.listen(5)

while 1:
    newsocket, clientaddr = server.accept()
    data = newsocket.recv(2048)
    print "Received data: {0} from {1}.".format(data, clientaddr)
    newsocket.sendall(data)
    print "Send data: {0}".format(data)


TCP Client

import socket

server_addr = ("127.1", 1234)
client      = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect(server_addr)
client.send("Hi, Rocky!")
data = client.recv(2048)
print "Received data: {0}".format(data)
client.close() #不要忘记关闭连接

```
